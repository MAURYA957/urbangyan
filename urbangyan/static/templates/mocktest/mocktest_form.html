{% extends "base.html" %}

{% block content %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Mock Test</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center">Create a Mock Test</h1>
        <form id="mockTestForm" method="POST" action="{% url 'mocktest-create' %}">
            {% csrf_token %}

            <div class="form-group">
                    <label for="Exam_Name">Exam Name:</label>
                    <input type="text" class="form-control" name="Exam_Name" required>
                </div>
                <div class="form-group">
                    <label for="Instructions">Instructions:</label>
                    <textarea class="form-control" name="Instructions" required></textarea>
                </div>
            <div class="form-group">
                <label for="duration">Test Duration:</label>
                <input type="text" class="form-control" name="duration" required placeholder="HH:MM:SS">
            </div>

            <h2>Subject Configurations</h2>
            <div id="subjectConfigs" class="mb-4">
                <div class="subjectConfig form-row align-items-end">
                    <div class="col">
                        <label for="subject">Subject:</label>
                        <select name="subject" class="form-control" required>
                            {% for subject in subjects %}
                            <option value="{{ subject.id }}">{{ subject.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col">
                        <label for="num_questions">Number of Questions:</label>
                        <input type="number" name="num_questions" class="form-control" required min="1">
                    </div>
                    <div class="col">
                        <label for="max_score">Max Score:</label>
                        <input type="number" name="max_score" class="form-control" required min="1">
                    </div>
                    <div class="col-auto">
                        <button type="button" class="btn btn-danger removeSubject">Remove</button>
                    </div>
                </div>
            </div>

            <button type="button" id="addSubject" class="btn btn-primary mb-3">Add Subject Configuration</button>
            <button type="submit" class="btn btn-success">Create Mock Test</button>
        </form>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.getElementById('addSubject').addEventListener('click', function() {
            const subjectConfigsDiv = document.getElementById('subjectConfigs');
            const newSubjectConfig = document.createElement('div');
            newSubjectConfig.classList.add('subjectConfig', 'form-row', 'align-items-end');
            newSubjectConfig.innerHTML = `
                <div class="col">
                    <label for="subject">Subject:</label>
                    <select name="subject" class="form-control" required>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <label for="num_questions">Number of Questions:</label>
                    <input type="number" name="num_questions" class="form-control" required min="1">
                </div>
                <div class="col">
                    <label for="max_score">Max Score:</label>
                    <input type="number" name="max_score" class="form-control" required min="1">
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-danger removeSubject">Remove</button>
                </div>
            `;
            subjectConfigsDiv.appendChild(newSubjectConfig);

            // Add event listener for the remove button
            newSubjectConfig.querySelector('.removeSubject').addEventListener('click', function() {
                subjectConfigsDiv.removeChild(newSubjectConfig);
            });
        });

        // Add event listeners for existing remove buttons
        document.querySelectorAll('.removeSubject').forEach(button => {
            button.addEventListener('click', function() {
                const subjectConfig = button.parentElement.parentElement;  // Adjust for the new structure
                subjectConfigsDiv.removeChild(subjectConfig);
            });
        });
    </script>
</body>
</html>
{% endblock content %}